<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_invoice_tree_qm" model="ir.ui.view">
        <field name="name">account.invoice.tree.inherit</field>
        <field name="model">account.move</field>
        <field name="mode">primary</field>
        <field name="priority" eval="1"/>
        <field name="arch" type="xml">
            <tree string="Sale Invoice Request"
                  decoration-info="receipt_state == 'draft'"
                  decoration-muted="receipt_state == 'cancel'"
                  banner_route="/account/account_invoice_onboarding"
                  js_class="account_tree">
                <field name="name"/>
                <field name="type" optional="show"/>
                <field name="partner_id" invisible="1"/>
                <field name="invoice_source_email" invisible="1"/>
                <field name="invoice_partner_icon" string=" "/>
                <field name="invoice_partner_display_name" invisible="context.get('default_type') not in ('in_invoice', 'in_refund','in_receipt')" groups="base.group_user" string="Vendor" />
                <field name="invoice_partner_display_name" invisible="context.get('default_type') not in ('out_invoice', 'out_refund','out_receipt')" groups="base.group_user" string="Customer" />
                <field name="create_date" optional="show" string="Create Date"/>
                
                <field name="invoice_origin" optional="show" string="Source Document"/>
                <field name="invoice_payment_ref" optional="hide" invisible="context.get('default_type') in ('out_invoice', 'out_refund','out_receipt')"/>
                <field name="ref" optional="hide"/>
                <field name="invoice_user_id" optional="hide" invisible="context.get('default_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Sales Person"/>
                <field name="invoice_date_due" optional="show"/>
                <field name="amount_untaxed_signed" string="Tax Excluded" sum="Total" optional="hide"/>
                <field name="amount_tax_signed" string="Tax" sum="Total" optional="hide"/>
                <field name="amount_total_signed" string="Total" sum="Total" optional="show"/>
                <field name="amount_residual_signed" string="Amount Due" sum="Amount Due" optional="hide"/>
                <field name="currency_id" invisible="1"/>
                <field name="company_currency_id" invisible="1"/>
                <field name="receipt_state" optional="show"/>
                <field name="invoice_payment_state" optional="show"/>
                <field name="type" invisible="context.get('default_type', True)"/>
                <field name="state" optional="show"/>
            </tree>
        </field>
    </record>

    <record id="view_account_move_form_qm" model="ir.ui.view">
        <field name="name">account.move.form.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
          <xpath expr="//button[@name='button_cancel']" position="replace">
            <button name="action_cancel" string="Cancel" type="object" attrs="{'invisible' : ['|', ('id', '=', False), ('receipt_state', '!=', 'draft')]}"/>
            <button name="action_approve" string="Approve" type="object" class="oe_highlight" attrs="{'invisible': [('receipt_state', '!=', 'posted')]}"/>
            <button name="action_reject" string="Reject" type="object" class="oe_highlight" attrs="{'invisible': [('receipt_state', 'in', ('draft', 'reject', 'cancel'))]}"/>
            <button name="action_cancel" string="Cancel" type="object" class="oe_highlight" attrs="{'invisible': [('receipt_state', '!=', 'cancel')]}"/>
          </xpath>

          <xpath expr="//button[@name='action_invoice_register_payment']" position="attributes">
              <attribute name="attrs">{'invisible': ['|', '|', ('state', '!=', 'posted'), ('invoice_payment_state', '!=', 'not_paid'), ('type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}</attribute>
          </xpath>
          <field name="state" position="replace">
            <field name="state" invisible="1"/>
            <field name="receipt_state" widget="statusbar" statusbar_visible="draft,posted,approved,reject,cancel"/>
          </field>

            <field name="ref" position="replace">
                <field name="receipt_state"/>
            </field>

            <xpath expr="//button[@name='action_invoice_register_payment']" position="attributes">
              <attribute name="attrs">{'invisible': ['|', '|', ('state', '!=', 'posted'), ('invoice_payment_state', '!=', 'not_paid'), ('type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}</attribute>
            </xpath>

            <xpath expr="//page[@id='invoice_tab']" position="after">
                <page id="account_invoices_tab" string="Invoices"
                      attrs="{'invisible': [('type', 'not in', ('out_receipt', 'in_receipt'))]}"
                      groups="account.group_account_invoice">
                    <field name="invoice_ids" mode="tree">
                        <tree editable="bottom" string="Invoices">
                            <field name="name"/>
                            <field name="code"/>
                            <field name="type"/>
                            <field name="tax_rate" optional="show"/>
                            <field name="amount_untaxed" optional="show" sum="Untaxed"/>
                            <field name="amount_tax" optional="show" sum="Tax"/>
                            <field name="amount_total" optional="show" sum="Total"/>
                            <field name="express_code" optional="show"/>
                            <field name="sent_type" optional="show"/>
                            <field name="sent_date" optional="show"/>
                            <field name="state" optional="show"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="model_account_move_action_down_xlsx" model="ir.actions.server">
        <field name="name">Download Xlsx</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_view_types">form,list</field>
        <field name="state">code</field>
        <field name="code">action = records.action_download_xlsx()</field>
    </record>


    <record id="action_move_out_invoice_refund_type_qm" model="ir.actions.act_window">
        <field name="name">Sale Invoices</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="view_id" ref="account.view_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('type', 'in', ('out_invoice', 'out_refund'))]</field>
        <field name="context">{'default_type': 'out_invoice'}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a customer invoice
          </p><p>
            Create invoices, register payments and keep track of the discussions with your customers.
          </p>
        </field>
    </record>

    <menuitem
        id="menu_action_move_out_invoice_refund_type_qm"
        action="action_move_out_invoice_refund_type_qm"
        parent="account.menu_finance_receivables"
        sequence="0" groups="qm.group_hidden_menu"/>

    <record id="account.menu_action_move_out_receipt_type" model="ir.ui.menu">
      <field name="name">Sale Receipts</field>
    </record>


    <record id="account.menu_action_account_payments_receivable" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>

    <record id="account.menu_action_move_in_invoice_type" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>

    <record id="account.menu_action_move_in_refund_type" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>

    <record id="account.menu_action_account_payments_payable" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>

    <record id="account.menu_action_move_in_receipt_type" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>

    
    <record id="account.menu_action_move_out_invoice_type" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>

    <record id="account.menu_action_move_out_refund_type" model="ir.ui.menu">
      <field name="groups_id" eval="[(6,0,[ref('qm.group_hidden_menu')])]"/>
    </record>


    <!-- 应该是隐藏掉 -->
    <!-- <data noupdate="1"> -->
    <!--     <delete model="ir.ui.menu" search="[('id','=',ref('account.menu_action_move_out_invoice_type'))]"/> -->
    <!--     <delete model="ir.ui.menu" search="[('id','=',ref('account.menu_action_move_out_refund_type'))]"/> -->
    <!-- </data> -->
</odoo>
